<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estado de ConexiÃ³n Â· Soluciones InformÃ¡tica AS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
 margin:0;
 padding:20px;
 font-family:Arial, sans-serif;
 background:#f8fafc;
}

.card{
 background:#ffffff;
 padding:18px;
 border-radius:18px;
 box-shadow:0 10px 25px rgba(0,0,0,.1);
 max-width:1100px;
 margin:auto;
}

h2{
 margin-top:0;
}

.grid{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:20px;
}

.info{
 font-size:14px;
 line-height:1.7;
}

.label{
 color:#64748b;
}

.value{
 font-weight:bold;
}

#map{
 height:420px;
 border-radius:14px;
 margin-top:15px;
 grid-column:1 / -1;
}

.badge{
 display:inline-block;
 padding:6px 14px;
 background:#16a34a;
 color:#fff;
 border-radius:20px;
 font-size:12px;
 margin-top:10px;
}

.company{
 font-size:15px;
 font-weight:bold;
 color:#2563eb;
 margin-bottom:6px;
}

@media(max-width:900px){
 .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="card">

  <div class="company">ğŸ¢ Soluciones InformÃ¡tica AS</div>
  <h2>ğŸ–¥ï¸ Estado del Equipo Conectado</h2>

  <div class="grid">

    <!-- UBICACIÃ“N -->
    <div class="info">
      <div class="label">ğŸ“ DirecciÃ³n</div>
      <div class="value" id="address">Obteniendo...</div>

      <div class="label">Latitud / Longitud</div>
      <div class="value">
        <span id="lat">â€”</span> ,
        <span id="lon">â€”</span>
      </div>

      <div class="label">PrecisiÃ³n</div>
      <div class="value"><span id="acc">â€”</span> metros</div>

      <div class="label">ğŸ•’ Fecha y hora de conexiÃ³n</div>
      <div class="value" id="fecha"></div>
    </div>

    <!-- EQUIPO -->
    <div class="info">
      <div class="label">ğŸ’» Equipo</div>
      <div class="value" id="device">â€”</div>

      <div class="label">ğŸŒ Navegador</div>
      <div class="value" id="browser">â€”</div>

      <div class="label">ğŸ“¶ Tipo de Internet</div>
      <div class="value" id="net">â€”</div>

      <span class="badge">CONEXIÃ“N ACTIVA</span>
    </div>

    <!-- MAPA -->
    <div id="map"></div>

  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ===== FECHA CONEXIÃ“N ===== */
document.getElementById("fecha").textContent =
 new Date().toLocaleString();

/* ===== EQUIPO Y NAVEGADOR ===== */
const ua = navigator.userAgent;

document.getElementById("device").textContent =
  /Android/i.test(ua) ? "MÃ³vil Android" :
  /iPhone|iPad/i.test(ua) ? "Dispositivo Apple" :
  /Windows/i.test(ua) ? "PC Windows" :
  /Mac/i.test(ua) ? "Mac" :
  "Equipo desconocido";

document.getElementById("browser").textContent =
  ua.includes("Edg") ? "Microsoft Edge" :
  ua.includes("Chrome") ? "Google Chrome" :
  ua.includes("Firefox") ? "Mozilla Firefox" :
  ua.includes("Safari") ? "Safari" :
  "Navegador desconocido";

/* ===== TIPO DE INTERNET ===== */
if(navigator.connection){
  const c = navigator.connection;
  document.getElementById("net").textContent =
    (c.type || "Red") + " Â· " + (c.effectiveType || "desconocido");
}else{
  document.getElementById("net").textContent = "No disponible";
}

/* ===== MAPA ===== */
const map = L.map("map").setView([0,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
 attribution:"Â© OpenStreetMap"
}).addTo(map);

let marker, circle;
let lastFetch = 0;

/* ===== GEOLOCALIZACIÃ“N REAL ===== */
navigator.geolocation.watchPosition(
  pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const acc = pos.coords.accuracy;

    document.getElementById("lat").textContent = lat.toFixed(6);
    document.getElementById("lon").textContent = lon.toFixed(6);
    document.getElementById("acc").textContent = Math.round(acc);

    map.setView([lat,lon],16);

    if(marker){
      marker.setLatLng([lat,lon]);
      circle.setLatLng([lat,lon]).setRadius(acc);
    }else{
      marker = L.marker([lat,lon])
        .addTo(map)
        .bindPopup("ğŸ“ UbicaciÃ³n del equipo")
        .openPopup();

      circle = L.circle([lat,lon],{
        radius:acc,
        color:"#2563eb",
        fillColor:"#2563eb",
        fillOpacity:0.2
      }).addTo(map);
    }

    const now = Date.now();
    if(now - lastFetch > 5000){
      lastFetch = now;
      reverseGeocode(lat, lon);
    }
  },
  err => alert("Error de ubicaciÃ³n: " + err.message),
  { enableHighAccuracy:true }
);

/* ===== LAT/LON â†’ DIRECCIÃ“N ===== */
function reverseGeocode(lat, lon){
  fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`)
    .then(r=>r.json())
    .then(d=>{
      document.getElementById("address").textContent =
        d.display_name || "DirecciÃ³n no disponible";
    })
    .catch(()=>{
      document.getElementById("address").textContent =
        "No se pudo obtener la direcciÃ³n";
    });
}
</script>

</body>
</html>
